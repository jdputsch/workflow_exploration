# Explore ways to get branch name, especially when running on a tag or specific SHA
name: CI

on:
  push:
  workflow_dispatch:

jobs:
  get_branch_info:
    runs-on: ubuntu-latest
    outputs:
      branch: ${{ steps.branch-name.outputs.branch }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Get branch names post-checkout
        id: branch-names
        uses: tj-actions/branch-names@v8

      - name: show-output
        run: |
          echo "Running on default branch? ${{ steps.branch-names.outputs.is_default }}"
          echo "Running on a tag? ${{ steps.branch-names.outputs.is_tag }}"
          echo "Default branch name is: ${{ steps.branch-names.outputs.default_branch }}"
          echo "The current branch name regardless of event_type: ${{ steps.branch-names.outputs.current_branch }}"
          echo "The target branch of a pull request: ${{ steps.branch-names.outputs.base_ref_branch }}"
          echo "The source branch of a pull request: ${{ steps.branch-names.outputs.head_ref_branch }}"
          echo "The branch that triggered the workflow run: ${{ steps.branch-names.outputs.ref_branch }}"
          echo "The tag that triggered the workflow run: "${{ steps.branch-names.outputs.tag }}

      - name: Get current branch
        id: branch-name
        run: |
          raw=$(git branch -r --contains ${{ github.ref }})
          echo "raw=$raw"
          branch="$(echo ${raw//origin\//} | tr -d '\n')"
          echo "{name}=branch" >> $GITHUB_OUTPUT
          echo "Branch is $branch."

  use_branch_name:
    runs-on: ubuntu-latest
    needs: get_branch_info

    steps:
      - run: |
          echo "Branch from other job: ${{ needs.get_branch_info.outputs.branch }}"
